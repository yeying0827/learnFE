## ç»„ä»¶åº“ï¼šå¦‚ä½•è®¾è®¡é€šç”¨ç»„ä»¶åº“

å­¦ä¹ è·¯å¾„ï¼š

* æ‹†è§£ä¸€ä¸‹Element3ç»„ä»¶åº“çš„ä»£ç 
* å‰–ç»ç»„ä»¶åº“ä¸­çš„ä¸€äº›ç»å…¸çš„ç»„ä»¶
* [practice commit](https://github.com/yeying0827/vue3-lib-learning/commit/764586456429b72f5fd27bb845311f335f93c429)

### ç¯å¢ƒæ­å»º

```shell
## åˆ›å»ºé¡¹ç›®
$ npm init vite       
Need to install the following packages:
  create-vite@4.1.0
Ok to proceed? (y) y
âœ” Project name: â€¦ vue3-lib-learning
âœ” Select a framework: â€º Vue
âœ” Select a variant: â€º TypeScript

Scaffolding project in /Users/ying.ye/CodeProjects/vue3-lib-learning...

Done. Now run:

  cd vue3-lib-learning
  npm install
  npm run dev
## ...

## æ·»åŠ ESLintä¾èµ–
$ yarn add eslint -D
yarn add v1.22.10
[1/4] ğŸ”  Resolving packages...
[2/4] ğŸšš  Fetching packages...

## åˆå§‹åŒ–ESLinté…ç½®
$ npx eslint --init
You can also run this command directly using 'npm init @eslint/config'.
Need to install the following packages:
  @eslint/create-config@0.4.2
Ok to proceed? (y) y
âœ” How would you like to use ESLint? Â· problems
âœ” What type of modules does your project use? Â· esm
âœ” Which framework does your project use? Â· vue
âœ” Does your project use TypeScript? Â· No / Yes
âœ” Where does your code run? Â· browser
âœ” What format do you want your config file to be in? Â· JSON
The config that you've selected requires the following dependencies:

eslint-plugin-vue@latest @typescript-eslint/eslint-plugin@latest @typescript-eslint/parser@latest
âœ” Would you like to install them now? Â· No / Yes
âœ” Which package manager do you want to use? Â· yarn
Installing eslint-plugin-vue@latest, @typescript-eslint/eslint-plugin@latest, @typescript-eslint/parser@latest
yarn add v1.22.10
[1/4] ğŸ”  Resolving packages...
[2/4] ğŸšš  Fetching packages...

## æ·»åŠ sassä¾èµ–
$ yarn add sass               
yarn add v1.22.10
[1/4] ğŸ”  Resolving packages...
[2/4] ğŸšš  Fetching packages...

## æ·»åŠ huskyä¾èµ–
$ yarn add husky -D              
yarn add v1.22.10
[1/4] ğŸ”  Resolving packages...
[2/4] ğŸšš  Fetching packages...
```

huskyåº“å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å¸®åŠ©æˆ‘ä»¬è®¾ç½®Gitçš„é’©å­å‡½æ•°ï¼Œå¯ä»¥å…è®¸æˆ‘ä»¬åœ¨ä»£ç æäº¤ä¹‹å‰è¿›è¡Œä»£ç è´¨é‡çš„ç›‘æµ‹ã€‚

ä½¿ç”¨æ­¥éª¤ï¼š

```shell
## éœ€è¦å…ˆæœ‰gité…ç½®
$ git init                              
Initialized empty Git repository in /Users/ying.ye/CodeProjects/vue3-lib-learning/.git/

## åˆå§‹åŒ–husky
$ npx husky install
husky - Git hooks installed

## æ–°å¢é’©å­
## ä½¿ç”¨npx husky addå‘½ä»¤æ–°å¢commit-msgé’©å­
$ npx husky add .husky/commit-msg "node scripts/verifyCommit.js"
husky - created .husky/commit-msg
## ä¼šåœ¨æ‰§è¡Œgit commitæäº¤ä»£ç çš„æ—¶å€™æ‰§è¡Œnode scripts/verifyCommit.jså‘½ä»¤æ¥æ ¡éªŒcommitä¿¡æ¯æ ¼å¼
```

```javascript
// scripts/verifyCommit.js
import fs from 'fs';

const msg = fs
    .readFileSync('.git/COMMIT_EDITMSG', 'utf-8')
    .trim() // å…ˆå» .git/COMMIT_EDITMSG æ–‡ä»¶ä¸­è¯»å–äº† commit æäº¤çš„ä¿¡æ¯

const commitRE = /^(revert: )?(feat|fix|docs|dx|style|refactor|perf|test|workflow|build|ci|chore|types|wip|release)(\(.+\))?: .{1,50}/
const mergeRe = /^(Merge pull request|Merge branch)/
if (!commitRE.test(msg)) { // ä½¿ç”¨äº†æ­£åˆ™å»æ ¡éªŒæäº¤ä¿¡æ¯çš„æ ¼å¼
    if(!mergeRe.test(msg)) {
        console.log('git commitä¿¡æ¯æ ¡éªŒä¸é€šè¿‡')

        console.error(`git commitçš„ä¿¡æ¯æ ¼å¼ä¸å¯¹, éœ€è¦ä½¿ç”¨ title(scope): descçš„æ ¼å¼
      æ¯”å¦‚ fix: xxbug
      feat(test): add new 
      å…·ä½“æ ¡éªŒé€»è¾‘çœ‹ scripts/verifyCommit.js
    `)
        process.exit(1)
    }

}else{
    console.log('git commitä¿¡æ¯æ ¡éªŒé€šè¿‡')
}
```

ä»£ç è¯´æ˜ï¼š

1. å…ˆå» .git/COMMIT_EDITMSG æ–‡ä»¶ä¸­è¯»å– commit æäº¤çš„ä¿¡æ¯

2. ä½¿ç”¨æ­£åˆ™å»æ ¡éªŒæäº¤ä¿¡æ¯çš„æ ¼å¼

   1. å¦‚æœcommitçš„ä¿¡æ¯ä¸ç¬¦åˆè¦æ±‚ï¼Œå°±ä¼šç›´æ¥æŠ¥é”™å¹¶ä¸”ç»ˆæ­¢ä»£ç çš„æäº¤

3. ç¡®ä¿åœ¨Githubä¸­çš„æäº¤æ—¥å¿—éƒ½ç¬¦åˆ`type(scope): message`çš„æ ¼å¼ï¼Œèƒ½å¤Ÿå¾ˆå¥½åœ°å¸®åŠ©æˆ‘ä»¬ç®¡ç†ç‰ˆæœ¬æ—¥å¿—ï¼Œæ ¡éªŒæ­£åˆ™çš„é€»è¾‘

   featä»£è¡¨æ–°åŠŸèƒ½ï¼Œdocsä»£è¡¨æ–‡æ¡£ï¼Œperfä»£è¡¨æ€§èƒ½

4. commi-msgæ˜¯ä»£ç æäº¤çš„æ—¶å€™æ‰§è¡Œçš„ï¼Œä»£ç æäº¤ä¹‹å‰è¿˜å¯ä»¥ä½¿ç”¨pre-commité’©å­å»æ‰§è¡ŒESLintæ ¡éªŒä»£ç æ ¼å¼

   ```shell
   $ npx husky add .husky/pre-commit "yarn test"
   ```



### å¸ƒå±€ç»„ä»¶

é¡¹ç›®ä¸­çš„ä¸šåŠ¡ç»„ä»¶ä¹Ÿæ˜¯ç”±é€šç”¨ç»„ä»¶æ‹¼æ¥è€Œæ¥çš„ã€‚

å¯ä»¥å‚è€ƒé¡¹ç›®æ¨¡å—çš„è§„èŒƒæ¥æ­å»ºç»„ä»¶åº“çš„æ¨¡æ¿ï¼ŒåŒ…æ‹¬sassã€ESLintç­‰ï¼Œç»„ä»¶åº“ä¼šåœ¨è¿™äº›è§„èŒƒä¹‹ä¸ŠåŠ å…¥å•å…ƒæµ‹è¯•æ¥è¿›ä¸€æ­¥ç¡®ä¿ä»£ç çš„å¯ç»´æŠ¤æ€§ã€‚

ä»¥ä¸‹æ˜¯å„ä¸ªç»„ä»¶çš„è´Ÿè´£èŒƒå›´ï¼š

* åŸºç¡€ç»„ä»¶

  è´Ÿè´£é¡¹ç›®æ•´ä½“çš„å¸ƒå±€å’Œè‰²å½©è®¾è®¡ã€‚åŸºæœ¬æ²¡æœ‰JavaScriptçš„å‚ä¸

* è¡¨å•ç»„ä»¶

  è´Ÿè´£ç”¨æˆ·çš„è¾“å…¥æ•°æ®ç®¡ç†ã€‚å¯¹ç”¨æˆ·çš„è¾“å…¥æ ¡éªŒæ˜¯æ¯”è¾ƒé‡è¦çš„åŠŸèƒ½ç‚¹

* æ•°æ®ç»„ä»¶

  è´Ÿè´£æ˜¾ç¤ºåå°çš„æ•°æ®ï¼Œæœ€é‡è¦çš„æ˜¯è¡¨æ ¼å’Œæ ‘å½¢ç»„ä»¶

* é€šçŸ¥ç»„ä»¶

  è´Ÿè´£é€šçŸ¥ç”¨æˆ·æ“ä½œçš„çŠ¶æ€ï¼ŒåŒ…æ‹¬è­¦å‘Šå’Œå¼¹çª—ã€‚å¦‚ä½•ç”¨å‡½æ•°åŠ¨æ€æ¸²æŸ“ç»„ä»¶æ˜¯è­¦å‘Šç»„ä»¶çš„é‡è¦åŠŸèƒ½ç‚¹ã€‚

ğŸŒ°ï¼šè®¾è®¡ä¸€ä¸ªåŸºç¡€çš„å¸ƒå±€ç»„ä»¶

å‚è€ƒ[Element3å¸ƒå±€å®¹å™¨é¡µé¢](https://e3.shengxinjing.cn/#/component/container)ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®ç°å¸¸è§çš„é¡µé¢å¸ƒå±€ã€‚

å¸ƒå±€ç»„ä»¶æ²¡æœ‰äº¤äº’é€»è¾‘ï¼Œåªéœ€é€šè¿‡flexå¸ƒå±€å°±å¯ä»¥å®ç°ã€‚

1. åœ¨src/components/ç›®å½•ä¸‹æ–°å¢containeræ–‡ä»¶å¤¹ï¼Œæ–°å»ºContainer.vueæ–‡ä»¶

2. åœ¨Element3ä¸­æ‰€æœ‰çš„æ ·å¼å‰ç¼€éƒ½æ˜¯elå¼€å¤´ï¼Œæ‰€ä»¥è®¾è®¡ä¹‹åˆè€ƒè™‘ä½¿ç”¨sassçš„mixinæ¥æé«˜ä¹¦å†™CSSçš„ä»£ç æ•ˆç‡

   1. åœ¨src/ç›®å½•ä¸‹æ–°å¢stylesæ–‡ä»¶å¤¹ï¼Œæ–°å»ºmixin.scssæ–‡ä»¶

      ```scss
      // src/styles/mixin.scss
      $namespace: 'el';
      
      @mixin b($block) {
        $B: $namespace + '-' + $block !global;
        .#{$B} {
          @content;
        }
      }
      
      @mixin when($state) {
        @at-root {
          $state-prefix: 'is-'; /*å¸¸é‡*/
          &.#{$state-prefix + $state} {
            @content;
          }
        }
      }
      ```

   2. è¯´æ˜ï¼š

      1. å®šä¹‰`$namespace`å˜é‡ä¸º`el`
      2. ä½¿ç”¨mixinæ³¨å†Œä¸€ä¸ªå‡½æ•°`b`ï¼Œå¯ä»¥é€šè¿‡ä¼ è¿›æ¥çš„æ ‡è¯†ç¬¦ç”Ÿæˆæ–°çš„æ ‡è¯†ç¬¦`$B`ï¼Œä½œä¸ºclassé€‰æ‹©å™¨çš„åç§°
      3. åŒæ—¶æ³¨å†Œä¸€ä¸ªå‡½æ•°whenï¼Œç”¨äºæ–°å¢classé€‰æ‹©å™¨ï¼Œå®ç°å¤šä¸ªclassçš„æ ·å¼

3. åœ¨Container.vueæ–‡ä»¶ä¸­ä½¿ç”¨ä¸Šè¿°sasså®šä¹‰çš„mixin

   ```vue
   <!-- src/components/container/Container.vue -->
   <style lang="scss">
   @import "../../styles/mixin";
   
   @include b(container) {
     display: flex;
     flex-direction: row;
     flex: 1;
     flex-basis: auto;
     box-sizing: border-box;
     min-width: 0;
     @include when(vertical) {
       flex-direction: column;
     }
   }
   </style>
   ```

   è¯´æ˜ï¼š

   * ä½¿ç”¨`b(container)`ç”Ÿæˆ`.el-container`æ ·å¼ç±»
   * åœ¨å‰é¢ç±»çš„å†…éƒ¨ï¼Œä½¿ç”¨`when(vertical)`ç”Ÿæˆ`.el-container.is-vertical`æ ·å¼ç±»ï¼Œå»ä¿®æ”¹flexçš„å¸ƒå±€æ–¹å‘
   * Containerç»„ä»¶å†…éƒ¨å¦‚æœæ²¡æœ‰Headeræˆ–Footerç»„ä»¶ï¼Œå°±æ˜¯æ¨ªå‘å¸ƒå±€ï¼Œå¦åˆ™å°±æ˜¯å‚ç›´å¸ƒå±€

4. ä½¿ç”¨æ ·å¼ç±»

   ```vue
   <!-- src/components/container/Container.vue -->
   <template>
     <div class="el-container"
          :class="{'is-vertical': isVertical}">
       <slot/>
     </div>
   </template>
   
   <script lang="ts">
   export default {
     name: 'ElContainer'
   }
   </script>
   <script setup lang="ts">
   import {useSlots, computed, VNode, Component} from "vue";
   
   interface Props {
     direction?: string
   }
   const props = defineProps<Props>();
   
   const slots = useSlots();
   
   const isVertical = computed(() => {
     if (slots && slots.default) {
       return slots.default().some((vn: VNode) => {
         const tag = (vn.type as Component).name;
         return tag === 'ElHeader' || tag === 'ElFooter';
       });
     } else {
       return props.direction === 'vertical';
     }
   })
   </script>
   ```

   templateä¸­ä½¿ç”¨el-containerå®¹å™¨åŒ…è£¹ï¼Œé€šè¿‡`:class`æ¥å®ç°æ ·å¼æ§åˆ¶å³å¯ã€‚

   è¯´æ˜ï¼š

   * script setupä¸­æ²¡æ³•è¿”å›ç»„ä»¶çš„åå­—ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªå•ç‹¬çš„æ ‡ç­¾ï¼Œä½¿ç”¨optionsçš„è¯­æ³•è®¾ç½®ç»„ä»¶çš„nameå±æ€§ã€‚

   * script setupå’ŒscriptæŒ‡å®šçš„langéœ€è¦ä¿æŒä¸€è‡´ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚
   * tså®ç°ç»„ä»¶çš„æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨interfaceå»å®šä¹‰ä¼ é€’çš„å±æ€§ç±»å‹ï¼ˆjsç›´æ¥ä½¿ç”¨definePropsï¼‰
   * ä½¿ç”¨computedå»åˆ¤æ–­Containerçš„æ–¹å‘æ˜¯å¦ä¸ºå‚ç›´

5. æ–°å»ºå…¶ä»–å¸ƒå±€å®¹å™¨ç»„ä»¶æ–‡ä»¶ï¼Œå¦‚Header.vue

   ```vue
   <!-- src/components/container/Header.vue -->
   <template>
     <div class="el-header"
     :style="{
       height
     }">
       <slot/>
     </div>
   </template>
   
   <script lang="ts">
   export default {
     name: 'ElHeader'
   }
   </script>
   <script setup lang="ts">
   import {withDefaults} from "vue";
   
   interface Props {
     height?: string
   }
   
   withDefaults(defineProps<Props>(), {
     height: '60px'
   })
   </script>
   
   <style lang="scss">
   @import '../../styles/mixin';
   @include b(header) {
     padding: $--header-padding;
     box-sizing: border-box;
     flex-shrink: 0;
   }
   </style>
   ```

   è¯´æ˜ï¼š

   é€šè¿‡`withDefaults()`è®¾ç½®Propsä¸­çš„é»˜è®¤å€¼

   æ ·å¼ä¸­ç”¨åˆ°çš„å˜é‡éƒ½åœ¨styles/mixinä¸­æ³¨å†Œï¼Œæ–¹ä¾¿å¤šä¸ªç»„ä»¶ä¹‹é—´çš„å˜é‡å…±äº«ã€‚



### ç»„ä»¶æ³¨å†Œ

ç»„ä»¶æ³¨å†Œå®Œæ¯•ä¹‹åï¼Œæˆ‘ä»¬åœ¨`src/App.vue`ä¸­ä½¿ç”¨importè¯­æ³•å¯¼å…¥åå°±å¯ä»¥ç›´æ¥ä½¿ç”¨äº†ã€‚

å­˜åœ¨çš„ä¸€ä¸ªå°é—®é¢˜ï¼š

ç»„ä»¶åº“æœ€åä¼šæœ‰å¾ˆå¤šç»„ä»¶å¯¹å¤–æš´éœ²ï¼Œç”¨æˆ·æ¯æ¬¡éƒ½importçš„è¯ç¡®å®å¤ªè¾›è‹¦äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦ä½¿ç”¨æ’ä»¶æœºåˆ¶å¯¹å¤–æš´éœ²å®‰è£…çš„æ¥å£

è§£å†³ï¼š

* åœ¨containerç›®å½•ä¸‹æ–°å»ºindex.ts

  ```typescript
  import {App} from 'vue';
  
  import Container from "./Container.vue";
  import Header from "./Header.vue";
  import Footer from "./Footer.vue";
  import Aside from "./Aside.vue";
  import Main from "./Main.vue";
  
  export default {
      install(app: App) {
          app.component(Container.name, Container);
          app.component(Header.name, Header);
          app.component(Footer.name, Footer);
          app.component(Aside.name, Aside);
          app.component(Main.name, Main);
      }
  }
  ```

  å¯¹å¤–æš´éœ²ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡çš„installæ–¹æ³•ä¸­ï¼Œä½¿ç”¨`app.component`æ³¨å†Œè¿™äº”ä¸ªç»„ä»¶ã€‚

* åœ¨`src/main.ts`æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨`app.use`çš„æ–¹å¼æ³¨å†Œå…¨éƒ¨å¸ƒå±€ç»„ä»¶

  è¿™æ ·åœ¨é¡¹ç›®å†…éƒ¨å°±å¯ä»¥å…¨å±€ä½¿ç”¨Containerã€Headerç­‰äº”ä¸ªç»„ä»¶ã€‚

  ```javascript
  import { createApp } from 'vue'
  import './style.css'
  import App from './App.vue'
  import ElContainer from "./components/container";
  
  createApp(App)
      .use(ElContainer) /*æ³¨å†Œå…¨éƒ¨å¸ƒå±€ç»„ä»¶*/
      .mount('#app')
  ```

* åœ¨å®é™…çš„ç»„ä»¶åº“å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªç»„ä»¶éƒ½ä¼šæä¾›ä¸€ä¸ªinstallæ–¹æ³•ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ ¹æ®é¡¹ç›®çš„éœ€æ±‚æŒ‰éœ€åŠ è½½



### ç»„ä»¶ä½¿ç”¨

åç»­ä¼šè®¾è®¡ ç»„ä»¶åº“çš„æ–‡æ¡£ç³»ç»Ÿ.

åœ¨`src/App.vue`ä¸­ï¼Œä½¿ç”¨ç»„ä»¶åµŒå¥—çš„æ–¹å¼å°±å¯ä»¥å®ç°ä¸‹é¢çš„é¡µé¢å¸ƒå±€ã€‚

```vue
<!-- src/App.vue -->
<script setup lang="ts">
import HelloWorld from './components/HelloWorld.vue'
</script>

<template>
  <el-container>
    <el-header>Header</el-header>
    <el-main>Main</el-main>
    <el-footer>Footer</el-footer>
  </el-container>
  <hr>
  <el-container>
    <el-header>Header</el-header>
    <el-container>
      <el-aside width="200px">Aside</el-aside>
      <el-main>Main</el-main>
    </el-container>
  </el-container>
  <hr>
  <el-container>
    <el-aside width="200px">Aside</el-aside>
    <el-container>
      <el-header>Header</el-header>
      <el-main>Main</el-main>
      <el-footer>Footer</el-footer>
    </el-container>
  </el-container>
</template>

<style scoped>
.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.vue:hover {
  filter: drop-shadow(0 0 2em #42b883aa);
}
</style>
<style>
body {
  display: block;
  width: 1000px;
  margin: 10px auto;
}
.el-header,
.el-footer {
  background-color: #ccc;
}
.el-main {
  background-color: #eee;
}
.el-aside {
  background-color: #ddd;
}
.el-header,
.el-aside,
.el-footer {
  display: flex;
  align-items: center;
  justify-content: center;
}
.el-main {
  line-height: 160px;
}
</style>
```



### æ€»ç»“

* ä»‹ç»äº†ç»„ä»¶åº“ä¸­çš„ç»„ä»¶åˆ†ç±»
* åŸºäºViteå’ŒTypeScriptæ­å»ºäº†ç»„ä»¶åº“çš„ä»£ç ç¯å¢ƒï¼Œä½¿ç”¨huskyå®ç°äº†ä»£ç æäº¤ä¹‹å‰çš„commitä¿¡æ¯å’ŒESLintæ ¼å¼æ ¡éªŒï¼Œç¡®ä¿åªæœ‰åˆæ ¼çš„ä»£ç èƒ½å¤Ÿæäº¤æˆåŠŸã€‚
* ä½¿ç”¨TypeScript+Sasså¼€å‘äº†å¸ƒå±€ç›¸å…³çš„ç»„ä»¶
  * å¦‚ä½•ä½¿ç”¨Sassæ¥æé«˜ç®¡ç†CSSä»£ç çš„æ•ˆç‡
  * å¦‚ä½•ä½¿ç”¨TypeScriptæ¥å¼€å‘ç»„ä»¶