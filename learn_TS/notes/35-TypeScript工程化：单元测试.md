## TypeScriptå·¥ç¨‹åŒ–ï¼šå•å…ƒæµ‹è¯•

å•å…ƒæµ‹è¯•æ˜¯ç°ä»£è½¯ä»¶å·¥ç¨‹ä¸­å¿…å¤‡çš„ç¯èŠ‚ä¹‹ä¸€

éœ€è¦å•å…ƒæµ‹è¯•æ¥ä¿è¯æˆ‘ä»¬çš„é€»è¾‘çš„å¥å£®æ€§

### å•å…ƒæµ‹è¯•å·¥å…·çš„é€‰æ‹©

åœ¨JS/TSçš„ä¸–ç•Œé‡Œæœ‰å¤ªå¤šçš„å•å…ƒæµ‹è¯•æ¡†æ¶å¯ä¾›é€‰æ‹©äº†ã€‚

#### Mocha

å®ƒæœ€å¤§çš„ä¼˜ç‚¹æ˜¯çµæ´»ï¼Œåªæä¾›ç»™å¼€å‘è€…ä¸€ä¸ªåŸºç¡€æµ‹è¯•ç»“æ„ã€‚

å…¶ä»–åŠŸèƒ½æ€§çš„åŠŸèƒ½å¦‚assertionsã€spiesã€mocksï¼Œä»¥åŠå’Œå®ƒä»¬ä¸€æ ·çš„å…¶ä»–åŠŸèƒ½éœ€è¦å¼•ç”¨æ·»åŠ å…¶ä»–åº“/æ’ä»¶æ¥å®Œæˆã€‚

éœ€è¦é¢å¤–åœ°å¼•å…¥ä¼—å¤šè¾…åŠ©åº“å’Œæ’ä»¶ï¼Œæ— å½¢ä¸­å¢åŠ äº†å­¦ä¹ æˆæœ¬å’Œé…ç½®æˆæœ¬ã€‚

Mochaçš„å¦ä¸€å¤§äº®ç‚¹æ˜¯å¯¹å¼‚æ­¥çš„å¼ºå¤§æ”¯æŒï¼ŒMochaä¸€å¼€å§‹æ˜¯ä¸ºNode.jsè€Œç”Ÿçš„å•å…ƒæµ‹è¯•æ¡†æ¶ï¼Œå¯¹æµè§ˆå™¨çš„æ”¯æŒå¹¶ä¸å¦‚å…¶å¯¹æœåŠ¡å™¨åšçš„é‚£ä¹ˆå¥½ã€‚

å¦‚æœéœ€è¦ä¸€ä¸ªé«˜åº¦å®šåˆ¶çš„æµ‹è¯•æ¡†æ¶ï¼ŒMochaæ˜¯éå¸¸å¥½çš„é€‰æ‹©ã€‚

#### Jasmine

å¦ä¸€ä¸ªæ¯”è¾ƒè€ç‰Œçš„æµ‹è¯•æ¡†æ¶Jasmineä¸»æ‰“çš„æ˜¯å¼€ç®±å³ç”¨ï¼Œå†…ç½®äº†ä¸€äº›æ–­è¨€åº“å’Œmockså·¥å…·ï¼Œå¹¶æä¾›äº†å…¨å±€å˜é‡éå¸¸æ–¹ä¾¿æˆ‘ä»¬çš„æµ‹è¯•ã€‚

#### Jest

Jestæ˜¯ä¸€ä¸ªçœŸæ­£æ„ä¹‰ä¸Šå¼€ç®±å³ç”¨çš„æµ‹è¯•æ¡†æ¶ï¼Œé›†æˆäº†å‡ ä¹å•å…ƒæµ‹è¯•ä¸­éœ€è¦çš„æ‰€æœ‰åŠŸèƒ½ï¼Œæ¯”å¦‚æ–­è¨€ã€æµ‹è¯•è¦†ç›–ç‡ç»Ÿè®¡ã€å¿«ç…§ç­‰ä¸€ç³»åˆ—åŠŸèƒ½ã€‚

æ¯”è¾ƒå‹å¥½åœ°æ”¯æŒå„ç§ç¯å¢ƒï¼Œç›®å‰å‰ç«¯ä¸‰å¤§æ¡†æ¶éƒ½é‡‡ç”¨äº†Jestä½œä¸ºæµ‹è¯•å·¥å…·ï¼Œå®ƒæœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š

* æ€§èƒ½â€”â€”é¦–å…ˆJeståŸºäºå¹¶è¡Œæµ‹è¯•å¤šæ–‡ä»¶ï¼Œæ‰€ä»¥åœ¨å¤§é¡¹ç›®ä¸­çš„è¿è¡Œé€Ÿåº¦ç›¸å½“å¿«ï¼ˆå¯ä»¥è®¿é—®[è¿™é‡Œ](https://hackernoon.com/testing-react-components-with-jest-and-enzyme-41d592c174f)ã€[è¿™é‡Œ](https://blog.kentcdodds.com/migrating-to-jest-881f75366e7e?gi=9add03f62b72)ã€[è¿™é‡Œ](https://medium.com/@gethylgeorge/testing-a-react-redux-app-using-jest-and-enzyme-b349324803a9)å’Œ[è¿™é‡Œ](https://medium.com/aya-experience/testing-an-angularjs-app-with-jest-3029a613251)äº†è§£æ›´å¤šï¼‰

* UIâ€”â€”æ¸…æ™°ä¸”æ“ä½œç®€å•

* Ready-To-Goâ€”â€”æœ‰æ–­è¨€ã€spiesã€mocksï¼Œå’ŒSinonèƒ½åšçš„äº‹å·®ä¸å¤šã€‚å’Œå…¶ä»–åº“çš„ç»“åˆä½¿ç”¨ä¹Ÿå¾ˆæ–¹ä¾¿ã€‚

* Globalsâ€”â€”å’ŒJasmineä¸€æ ·ï¼Œé»˜è®¤[åˆ›å»ºå…¨å±€ç¯å¢ƒ](https://facebook.github.io/jest/docs/en/api.html)ã€‚è¿™ä¸€ç‰¹æ€§ä¼šé™ä½ä»£ç çµæ´»æ€§å’Œå¥å£®æ€§ï¼Œä¸è¿‡å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä½ éƒ½ä¼šåº†å¹¸Jestæœ‰è¿™ä¹ˆä¸€ä¸ªåŠŸèƒ½ï¼š

  ```javascript
  // "describe" å·²ç»åœ¨å…¨å±€ä½œç”¨åŸŸä¸­
  // ä¸éœ€è¦å†è¿™æ · "require" æ¨¡å—äº†
  // import { describe } from 'jest'
  // import { describe } from 'jasmine'
  
  describe('calculator', function() {
    ...
  })
  ```

  éå¸¸æ–¹ä¾¿æµ‹è¯•è€…è°ƒç”¨ã€‚

* å¿«ç…§æµ‹è¯•â€”â€”Jestå¿«ç…§åŠŸèƒ½ç”±FBå¼€å‘å’Œç»´æŠ¤ï¼Œå®ƒè¿˜å¯ä»¥å¹³ç§»åˆ°åˆ«çš„æ¡†æ¶ä¸Šä½œä¸ºæ’ä»¶ä½¿ç”¨ã€‚

* æ›´å¼ºå¤§çš„æ¨¡å—çº§mockingåŠŸèƒ½â€”â€”Jestå…è®¸å¼€å‘è€…ç”¨éå¸¸ç®€å•çš„æ–¹æ³•mockå¾ˆé‡çš„åº“ï¼Œè¾¾åˆ°æé«˜æµ‹è¯•æ•ˆç‡çš„ç›®çš„ã€‚æ¯”å¦‚å¯ä»¥æ¨¡æ‹Ÿä¸€ä¸ªpromiseçš„resolveï¼Œè€Œä¸æ˜¯çœŸçš„è¿›è¡Œç½‘ç»œè¯·æ±‚

* ä»£ç è¦†ç›–æ£€æŸ¥â€”â€”å†…ç½®äº†ä¸€ä¸ªåŸºäºIstanbulçš„ä»£ç è¦†ç›–å·¥å…·ï¼ŒåŠŸèƒ½å¼ºå¤§ä¸”æ€§èƒ½é«˜

* æ”¯æŒæ€§â€”â€”Jeståœ¨2016å¹´æœ«å’Œ2017å¹´åˆå‘å¸ƒäº†å¤§ç‰ˆæœ¬ï¼Œå„æ–¹é¢éƒ½æœ‰äº†å¾ˆå¤§æå‡ï¼Œå¤§éƒ¨åˆ†ä¸»æµIDEå’Œå·¥å…·éƒ½å·²æ”¯æŒ

* å¼€å‘â€”â€”Jestä»…ä»…æ›´æ–°è¢«ä¿®æ”¹çš„æ–‡ä»¶ï¼Œæ‰€ä»¥åœ¨ç›‘æ§æ¨¡å¼ï¼ˆwatch modeï¼‰ä¸‹è¿è¡Œé€Ÿåº¦éå¸¸å¿«

Jestæ­£æ˜¯åŸºäºJasmineå¼€å‘è€Œæ¥ï¼Œæ¯”Jasmineæ›´åŠ å¤§è€Œå…¨ï¼Œæ›´åŠ å¼€ç®±å³ç”¨ã€‚

#### é€‰æ‹©

ä¸¤æ¡è·¯ï¼Œä¸€æ¡æ˜¯çµæ´»é…ç½®ä½†å­¦ä¹ æˆæœ¬é™¡å³­çš„Mochaï¼Œå¦ä¸€æ¡æ˜¯å¤§è€Œå…¨å¼€ç®±å³ç”¨å´æ²¡é‚£ä¹ˆçµæ´»çš„Jestã€‚

å¤šæ•°æ²¡æœ‰ç‰¹æ®Šè¦æ±‚çš„æƒ…å†µä¸‹Jestä¼šæ›´é€‚åˆï¼Œæµ‹è¯•æ¡†æ¶åªæ˜¯ä¸€ä¸ªå·¥å…·ï¼Œé€‰æ‹©ä¸€ä¸ªå‡ ä¹ä¸éœ€è¦é…ç½®ã€å¼€ç®±å³ç”¨çš„æ¡†æ¶å¯ä»¥å¤§å¤§æé«˜ç”Ÿäº§æ•ˆç‡ã€‚



### Jesté…ç½®

#### å®‰è£…Jest

å…¨å±€å®‰è£…ï¼š

```shell
npm i jest -g
```

åœ¨é¡¹ç›®ä¸­å®‰è£…ï¼š

```shell
npm i -D jest @types/jest
#
$ yarn add jest @types/jest -D
```

#### åˆå§‹åŒ–Jest

åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆå§‹åŒ–jestï¼š

```shell
$ ./node_modules/.bin/jest --init  

The following questions will help Jest to create a suitable configuration for your project

âœ” Would you like to use Jest when running "test" script in "package.json"? â€¦ yes
âœ” Would you like to use Typescript for the configuration file? â€¦ yes
âœ” Choose the test environment that will be used for testing â€º node
âœ” Do you want Jest to add coverage reports? â€¦ yes
âœ” Which provider should be used to instrument code for coverage? â€º v8
âœ” Automatically clear mock calls, instances, contexts and results before every test? â€¦ yes

âœï¸  Modified /Users/ying.ye/CodeProjects/learnFE/learn_TS/eslint-study/package.json

ğŸ“  Configuration file created at /Users/ying.ye/CodeProjects/learnFE/learn_TS/eslint-study/jest.config.ts
```

`Choose the test environment that will be used for testing` éœ€è¦é€‰æ‹©æµ‹è¯•æ‰§è¡Œç¯å¢ƒï¼Œæœ‰æµè§ˆå™¨å’Œnodeä¸¤ä¸ªé€‰é¡¹ï¼Œé€‰æ‹©ç®€å•çš„nodeç¯å¢ƒ

`Do you want Jest to add coverage reports?` æ˜¯å¦éœ€è¦æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Šï¼Œé€šå¸¸æƒ…å†µä¸‹è¿™ä¸ªæŠ¥å‘Šå¾ˆé‡è¦ï¼Œæ˜¯æˆ‘ä»¬æ•´ä½“æµ‹è¯•æƒ…å†µçš„ä¸€ä¸ªæŠ¥å‘Š

`Automatically clear mock calls, instances, contexts and results before every test?` æ˜¯å¦åœ¨æµ‹è¯•ç»“æŸåå¸®æˆ‘ä»¬è‡ªåŠ¨æ¸…é™¤ä¸€äº›æ¨¡æ‹Ÿçš„å®ä¾‹ç­‰ç­‰ï¼Œé€‰æ‹©yesï¼Œé¿å…è¿™äº›ä¸œè¥¿å½±å“æˆ‘ä»¬çš„ä¸‹æ¬¡æµ‹è¯•

#### é…ç½®é¡¹

æ­¤æ—¶æ ¹ç›®å½•ä¸‹ç”Ÿæˆäº†ä¸€ä¸ªå«`jest.config.js`çš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°é‡Œé¢æœ‰éå¸¸å¤šçš„é…ç½®é¡¹ã€‚

æ¯”å¦‚`clearMocks: true,`ç”¨äºæ¸…é™¤æ¨¡æ‹Ÿæ®‹ç•™çš„é…ç½®ï¼Œ`coverageDirectory: "coverage",`å°±æ˜¯æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Šçš„é…ç½®ï¼Œ`testEnvironment: 'jest-environment-node',`æ˜¯ä¹‹å‰é€‰æ‹©çš„æµ‹è¯•ç¯å¢ƒ

ä»¥ä¸Šåªæ˜¯åŸºç¡€é…ç½®ï¼Œå¦‚æœæƒ³è¦åœ¨TypeScripté¡¹ç›®ä¸­ä½¿ç”¨ï¼Œè¿˜éœ€è¦è¿›ä¸€æ­¥çš„é…ç½®ï¼Œéœ€è¦åœ¨é…ç½®ä¸­åŠ å…¥ä»¥ä¸‹é€‰é¡¹ï¼š

```json
{
  moduleFileExtensions: [
      'ts',
      'tsx',
      'js',
      'jsx',
      'json',
      'node'
  ],
  transform: {
    '^.+\\.tsx?$': 'ts-jest'
  },
  testMatch: [
    "**/__tests__/**/*.[jt]s?(x)",
    "**/?(*.)+(spec|test).[tj]s?(x)"
  ],
}
```

* moduleFileExtensions: æ¨¡å—æ–‡ä»¶æ‰©å±•åã€‚å½“å¼•å…¥ä¸€ä¸ªæ¨¡å—å¹¶æ²¡æœ‰æŒ‡å®šæ‰©å±•åæ—¶ï¼Œå®ƒä¼šä¾æ¬¡å°è¯•å»æ·»åŠ è¿™äº›æ‰©å±•åå»æ‹Ÿå¼•å…¥æ¨¡å—æ–‡ä»¶
* transformï¼šä¸€ç§è½¬æ¢å™¨é…ç½®ã€‚ç”±äºJesté»˜è®¤çš„è½¬æ¢å™¨ä¸æ”¯æŒTypeScriptï¼Œå› æ­¤éœ€è¦ts-jestå·¥å…·æŠŠ`.ts`å’Œ`.tsx`æ–‡ä»¶å†…å®¹è½¬æ¢æˆjsã€‚ç°åœ¨åŸºæœ¬ä¸Šéƒ½æ˜¯ç”¨tså»ç¼–å†™æµ‹è¯•ä»£ç ï¼Œæ‰€ä»¥è¦é…ç½®è½¬æ¢å™¨
* testMatchï¼šè®¾ç½®è¯†åˆ«å“ªäº›æ–‡ä»¶æ˜¯æµ‹è¯•æ–‡ä»¶ï¼ˆglobå½¢å¼ï¼‰

ä»¥ä¸Šå°±æ˜¯éœ€è¦é…ç½®çš„é€‰é¡¹ï¼Œéœ€è¦å®‰è£…`ts-jest`ä¾èµ–ã€‚å®˜ç½‘çš„[é…ç½®Jest](https://doc.ebichu.cc/jest/docs/zh-Hans/configuration.html)



### Jestçš„ä½¿ç”¨

æ›´å¤šèµ„æ–™å‚è€ƒ[Jestå®˜ç½‘](https://doc.ebichu.cc/jest/docs/zh-Hans/getting-started.html#content)

#### åŒ¹é…å™¨çš„ä½¿ç”¨

æ–°å»ºä¸€ä¸ªç›®å½•`src/`å¹¶åœ¨æ­¤ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶`add.ts`ï¼Œç¼–å†™å†…å®¹å¦‚ä¸‹ï¼š

```typescript
// src/add.ts
export function add(item: number, ...rest: number[]): number {
    return rest.reduce((a: number, b: number) => a + b, item);
}
```

å®ç°ä¸€ä¸ªéå¸¸ç®€å•çš„ç´¯åŠ å‡½æ•°ï¼Œç„¶åå¼€å§‹è¿›è¡Œæµ‹è¯•ã€‚

å…ˆåˆ›å»ºä¸€ä¸ªæ–‡ä»¶`add.test.ts`ï¼Œä½¿ç”¨ä¸€ä¸ªæœ€ç®€å•çš„åŒ¹é…å™¨ï¼š

```typescript
// src/add.test.ts
import {add} from "./add";

test('two plus two is four', () => {
    expect(add(2, 2)).toBe(4);
})
```

åœ¨æ­¤æ®µä»£ç ä¸­ï¼Œ`expect(add(2, 2))`è¿”å›ä¸€ä¸ªâ€æœŸå¾…â€œçš„å¯¹è±¡ï¼Œ`.toBe(4)`åˆ™æ˜¯åŒ¹é…å™¨ï¼Œæˆ‘ä»¬æœŸæœ›è¿™ä¸ªå‡½æ•°è¿è¡Œçš„ç»“æœæ˜¯`4`ï¼Œå¦‚æœåŒ¹é…å¤±è´¥ï¼ŒJestè¿è¡Œæ—¶ï¼Œå®ƒä¼šè·Ÿè¸ªæ‰€æœ‰å¤±è´¥çš„åŒ¹é…å™¨ï¼Œä»¥ä¾¿å®ƒå¯ä»¥ä¸ºä½ æ‰“å°å‡ºå¾ˆå¥½çš„é”™è¯¯æ¶ˆæ¯ã€‚

å¦‚æœæƒ³æµ‹è¯•ç›¸åçš„åŒ¹é…ï¼Œå¯ä»¥å¦‚ä¸‹ï¼š

```typescript
test('two plus two is not six', () => {
    expect(add(2, 2)).not.toBe(6);
})
```

æ­¤æ—¶è¿è¡Œä¸€ä¸‹`yarn test`ï¼Œç»“æœå¦‚ä¸‹ï¼š

```
$ yarn test
yarn run v1.22.10
$ jest
 PASS  src/add.test.ts
  âœ“ two plus two is four (2 ms)
  âœ“ two plus two is not six

----------|---------|----------|---------|---------|-------------------
File      | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
----------|---------|----------|---------|---------|-------------------
All files |     100 |      100 |     100 |     100 |                   
 add.ts   |     100 |      100 |     100 |     100 |                   
----------|---------|----------|---------|---------|-------------------
Test Suites: 1 passed, 1 total
Tests:       2 passed, 2 total
Snapshots:   0 total
Time:        1.53 s
Ran all test suites.
âœ¨  Done in 4.04s.
```

æ–°å»ºçš„é¡¹ç›®å¿˜è®°æ·»åŠ tsconfig.jsonæ–‡ä»¶ï¼Œå¯¼è‡´ä¸€ç›´æŠ¥é”™`Cannot find name 'test'. Do you need to install type definitions for a test runner?`ï¼Œæ‰¾åˆ°[ä¸€ç¯‡æ–‡ç« ](https://blog.csdn.net/weixin_41894089/article/details/127013405)è¯´éœ€è¦é…ç½®tsconfig.jsonæ–‡ä»¶ï¼Œæ‰å‘ç°è¿™ä¸ªæ–‡ä»¶éƒ½æ²¡åˆ›å»ºğŸ˜…

ç¼–å†™ä»£ç çš„è¿‡ç¨‹ä¸­TypeScriptçš„æç¤ºä¼šæ˜¾ç¤ºéå¸¸å¤šçš„åŒ¹é…å™¨ï¼Œè¿™ä¹Ÿæ˜¯TypeScriptçš„ä¼˜åŠ¿ä¹‹ä¸€ï¼Œå¦‚æ­¤ç¹å¤šçš„APIï¼Œä¼˜ç§€çš„ä»£ç æç¤ºä¼šå¸®åŠ©æˆ‘ä»¬å¿«é€Ÿä½¿ç”¨ï¼Œè€Œä¸å¿…ä¸€ä¸ªä¸ªæŸ¥é˜…å®˜æ–¹çš„æ–‡æ¡£ã€‚

åŒ¹é…å®Œç®€å•çš„æ•°å­—ï¼Œå¯ä»¥å°è¯•åŒ¹é…å¯¹è±¡äº†ã€‚

æ–°å»ºä¸€ä¸ªæ–‡ä»¶`src/person.ts`ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```typescript
// src/person.ts
export class Person {
    public name: string;
    public age: number;
    constructor(name: string, age: number) {
        this.age = age;
        this.name = name;
    }

    public say(message: string) {
        return message;
    }
}
```

åŒæ ·æ–°å»ºä¸€ä¸ªæµ‹è¯•æ–‡ä»¶`person.test.ts`ï¼š

```typescript
// src/person.test.ts
import {Person} from "./person";

test('test person', () => {
    const person = new Person('hanmeimei', 12);

    expect(person).toBeInstanceOf(Person);
    expect(person).not.toEqual({
        name: 'cxk'
    });
})
```

`toBeInstanceOf`ç”¨äºåŒ¹é…å®ä¾‹`person`æ˜¯å¦æ˜¯ç”±`Person`æ„é€ çš„ï¼Œ`toEqual`æ˜¯æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸åŒã€‚

æµ‹è¯•ç»“æœï¼š

```
$ yarn test
yarn run v1.22.10
$ jest
 PASS  src/add.test.ts
 PASS  src/person.test.ts
-----------|---------|----------|---------|---------|-------------------
File       | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
-----------|---------|----------|---------|---------|-------------------
All files  |   86.66 |      100 |   66.66 |   86.66 |                   
 add.ts    |     100 |      100 |     100 |     100 |                   
 person.ts |   83.33 |      100 |      50 |   83.33 | 10-11             
-----------|---------|----------|---------|---------|-------------------

Test Suites: 2 passed, 2 total
Tests:       3 passed, 3 total
Snapshots:   0 total
Time:        3.024 s
Ran all test suites.
âœ¨  Done in 5.65s.
```

#### å¼‚æ­¥æµ‹è¯•

æ–°å»ºä¸€ä¸ªæ–‡ä»¶`src/getTopics.ts`ï¼Œä»£ç å¦‚ä¸‹ï¼šå£°æ˜ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºè·å–cnodeè®ºå›çš„é¦–é¡µä¸»é¢˜å¸–

```typescript
// src/getTopics.ts
import axios from 'axios';

const url = 'https://cnodejs.org/api/v1/topics';

export async function getTopics() {
    const res = await axios.get(url);
    return res;
}
```

å†æ–°å»ºä¸€ä¸ªæµ‹è¯•æ–‡ä»¶`src/getTopics.test.ts`ï¼Œè‹¥è¦ç¼–å†™asyncæµ‹è¯•ï¼Œåªè¦åœ¨å‡½æ•°å‰é¢ä½¿ç”¨asyncå…³é”®å­—ä¼ é€’åˆ°testï¼š

```typescript
// src/getTopics.test.ts
import {getTopics} from "./getTopics";

test('should', async () => {
    const { data } = await getTopics();

    expect(data).not.toBeUndefined();
    expect(data.success).toBeTruthy();
})
```

å¼‚æ­¥æµ‹è¯•åœ¨nodeæœåŠ¡ç«¯çš„æµ‹è¯•åœºæ™¯ä¸­éå¸¸å¸¸ç”¨ã€‚

æµ‹è¯•ç»“æœï¼š

```
$ yarn test     
yarn run v1.22.10
$ jest

 RUNS  src/getTopics.test.ts
 PASS  src/person.test.ts

 RUNS  src/getTopics.test.ts

 RUNS  src/getTopics.test.ts
 PASS  src/add.test.ts

 RUNS  src/getTopics.test.ts
 PASS  src/getTopics.test.ts
--------------|---------|----------|---------|---------|-------------------
File          | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
--------------|---------|----------|---------|---------|-------------------
All files     |    91.3 |      100 |      75 |    91.3 |                   
 add.ts       |     100 |      100 |     100 |     100 |                   
 getTopics.ts |     100 |      100 |     100 |     100 |                   
 person.ts    |   83.33 |      100 |      50 |   83.33 | 10-11             
--------------|---------|----------|---------|---------|-------------------

Test Suites: 3 passed, 3 total
Tests:       4 passed, 4 total
Snapshots:   0 total
Time:        3.527 s
Ran all test suites.
âœ¨  Done in 6.13s.
```

#### æ¨¡æ‹Ÿå‡½æ•°

å†æ–°å»ºä¸€ä¸ªæ–‡ä»¶`src/myForEach.ts`ï¼Œåˆ›å»ºä¸€ä¸ªéå†å‡½æ•°

```typescript
// src/myForEach.ts
export function myForEach(items: Array<number>, callback: (a: number) => void) {
    for (let i = 0; i < items.length; i ++) {
        callback(items[i])
    }
}
```

ä¸ºäº†æµ‹è¯•æ­¤å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ¨¡æ‹Ÿå‡½æ•°ï¼Œç„¶åæ£€æŸ¥æ¨¡æ‹Ÿå‡½æ•°çš„çŠ¶æ€æ¥ç¡®ä¿å›è°ƒå‡½æ•°å¦‚æœŸè°ƒç”¨ã€‚

åœ¨`src/myForEach.test.ts`ä¸­ï¼Œå¯ä»¥ç”¨`jest.fn()`æ¨¡æ‹Ÿå‡½æ•°ï¼Œæ¥æµ‹è¯•è°ƒç”¨æƒ…å†µï¼š

```typescript
// src/myForEach.test.ts
import {myForEach} from "./myForEach";

test('should call twice', () => {
    const mockCallback = jest.fn();
    myForEach([0, 1], mockCallback);
  
    // console.log(mockCallback.mock);

    // æ­¤æ¨¡æ‹Ÿå‡½æ•°è¢«è°ƒç”¨äº†ä¸¤æ¬¡
    expect(mockCallback.mock.calls.length).toBe(2);

    // ç¬¬ä¸€æ¬¡è°ƒç”¨å‡½æ•°æ—¶çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯0
    expect(mockCallback.mock.calls[0][0]).toBe(0);

    // ç¬¬äºŒæ¬¡è°ƒç”¨å‡½æ•°æ—¶çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯1
    expect(mockCallback.mock.calls[1][0]).toBe(1);
})
```

ä¸Šè¿°æµ‹è¯•çš„æ¨¡æ‹Ÿå‡½æ•°`mockCallback`æœ‰ä¸€ä¸ª`mock`å±æ€§ï¼Œå®ƒä¿å­˜äº†æ­¤å‡½æ•°è¢«è°ƒç”¨çš„ä¸€ç³»åˆ—ä¿¡æ¯ï¼Œå¯ä»¥æŠŠå®ƒæ‰“å°å‡ºæ¥ï¼š`console.log(mockCallback.mock);`

```json
{
  calls: [ [ 0 ], [ 1 ] ],
  contexts: [ undefined, undefined ],
  instances: [ undefined, undefined ],
  invocationCallOrder: [ 1, 2 ],
  results: [
    { type: 'return', value: undefined },
    { type: 'return', value: undefined }
  ],
  lastCall: [ 1 ]
}
```



### å°ç»“

é€šè¿‡Jestçš„å®‰è£…ã€é…ç½®ã€ä½¿ç”¨å­¦ä¹ äº†åœ¨TypeScriptä¸‹è¿›è¡Œç®€å•çš„å•å…ƒæµ‹è¯•ï¼Œä¸¥æ ¼çš„ä»£ç æ£€æµ‹ã€é™æ€ç±»å‹æ£€æŸ¥é…åˆä¸Šå……åˆ†çš„å•å…ƒæµ‹è¯•ï¼Œè¿™æ˜¯ä¿è¯é¡¹ç›®å¥å£®æ€§ã€å¯ç»´æŠ¤æ€§çš„æ ¹æœ¬ã€‚

å‚è€ƒï¼š[å±•æœ›2018å¹´JavaScript Testing](https://zhuanlan.zhihu.com/p/32702421)