## å®æˆ˜ç—›ç‚¹3ï¼šVue3ä¸­å¦‚ä½•é›†æˆç¬¬ä¸‰æ–¹æ¡†æ¶

æœ‰çš„ç¬¬ä¸‰æ–¹å·¥å…·æ¡†æ¶è·ŸVueè€¦åˆæ€§ä¸é«˜ï¼Œè€Œæœ‰çš„éœ€è¦åšé€‚é…ã€‚

### ç‹¬ç«‹çš„ç¬¬ä¸‰æ–¹åº“

å®Œå…¨ç‹¬ç«‹äºVueæ¡†æ¶

ä½¿ç”¨æ­¤ç±»ç‹¬ç«‹çš„æ¡†æ¶éœ€è¦ä»¥ä¸‹ä¸¤æ­¥ï¼ˆä»¥é¡µé¢è¿›åº¦æ¡å·¥å…·NProgressä¸ºä¾‹ï¼‰ï¼š

1. åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œå®‰è£…ä¾èµ–NProgress

   ```shell
   yarn add nprogress
   ```

2. åœ¨éœ€è¦ä½¿ç”¨NProgressçš„åœ°æ–¹è¿›è¡Œimportå¯¼å…¥ï¼Œç„¶åè°ƒç”¨ç›¸å…³æ“ä½œ

   æ¯”å¦‚ï¼šåœ¨é¡µé¢è·³è½¬çš„æ—¶å€™ï¼Œä½¿ç”¨NProgressä½œä¸ºè¿›åº¦æ¡ã€‚

   ```typescript
   // src/router/index.ts
   import {createRouter, createWebHashHistory, Router, RouteRecordRaw} from 'vue-router';
   // import {createRouter, createWebHashHistory, createWebHistory} from './grouter';
   import NProgress from 'nprogress';
   
   // ...
   
   const routes: Array<RouteRecordRaw> = [
       // ...
   ];
   
   const router: Router = createRouter({
       history: createWebHashHistory(),
       // history: createWebHistory(),
       routes
   });
   
   router.beforeEach((to, from, next) => {
       NProgress.start(); // æ˜¾ç¤ºè¿›åº¦æ¡
       // ...
   })
   
   router.afterEach(() => {
       NProgress.done(); // è¿›åº¦æ¡ç»“æŸ
   })
   
   export default router;
   ```

   ä¸éœ€è¦ä½¿ç”¨Vue3çš„æ’ä»¶æœºåˆ¶è¿›è¡Œæ³¨å†Œ

   ç±»ä¼¼çš„è¿˜æœ‰å¤„ç†Excelçš„xlsxåº“ã€å¤„ç†å‰ªåˆ‡æ¿çš„clipboardåº“ç­‰ç­‰



### ç»„ä»¶çš„å°è£…

ä»¥å¯è§†åŒ–ç»„ä»¶ä¸ºä¾‹

ğŸŒ°ï¼šåœ¨é¡µé¢ä¸­ä»¥ç»„ä»¶çš„å½¢å¼æ˜¾ç¤ºå¯è§†åŒ–å›¾è¡¨ã€‚

æ­¤å¤„ä½¿ç”¨å¯è§†åŒ–æ¡†æ¶Echartså»å°è£…Vueç»„ä»¶ï¼Œæ¥å®ç°å¯è§†åŒ–ç»„ä»¶

å¯è§†åŒ–æ¡†æ¶çš„ä½¿ç”¨æ–¹å¼ï¼š

1. å®Œæˆå›¾è¡¨åº“çš„é…ç½®ï¼š

   `echarts.init`

   åˆ›å»º`option`å¯¹è±¡è®¾ç½®é…ç½®é¡¹

2. å¡«å…¥å›¾è¡¨æ•°æ®

   optionså¯¹è±¡çš„serieså±æ€§é…ç½®äº†é¡µé¢çš„æ•°æ®

3. æœ€åæŠŠè¿™ä¸ªæ•°æ®æ¸²æŸ“åœ¨ä¸€ä¸ªDOMä¸Šå³å¯

   `echarts.setOption`æ ¹æ®é…ç½®å’Œæ•°æ®æ¸²æŸ“DOM

Vue3é›†æˆEchartsæ¡†æ¶ï¼šå®ç°ä¸Echartså¯¹åº”çš„Vueç»„ä»¶å³å¯ã€‚

æœ€ç®€å•çš„æ–¹å¼ï¼š

1. å°è£…ä¸€ä¸ªChartç»„ä»¶
2. æŠŠoptioné…ç½®ä»¥å‚æ•°çš„å½¢å¼ä¼ é€’ç»™Chartç»„ä»¶
3. ç»„ä»¶å†…éƒ¨è¿›è¡Œæ¸²æŸ“å³å¯

```vue
<!-- src/components/Chart.vue -->
<template>
  <div class="chart" ref="chartRef"></div>
</template>

<script setup>
import * as echarts from 'echarts';
import {ref, onMounted, onUnmounted} from "vue";

let chartRef = ref();
let myChart;

onUnmounted(() => {
  myChart.dispose();
  myChart = null;
});

onMounted(() => {
  myChart = echarts.init(chartRef.value);
  const option = {
    tooltip: {
      trigger: 'item'
    },
    color: ['#ffd666', '#ffa39e', '#409eff'],
    // æ•°æ®
    series: [
      {
        name: 'å‰ç«¯è¯¾ç¨‹',
        type: 'pie', // é¥¼å›¾
        data: [
          {value: 43340, name: 'é‡å­¦å‰ç«¯'},
          {value: 7003, name: 'JavaScriptæ ¸å¿ƒåŸç†è§£æ'},
          {value: 4314, name: 'ç©è½¬vue3å…¨å®¶æ¡¶'}
        ]
      }
    ]
  };
  myChart.setOption(option);
});
</script>

<style>
.chart {
  height: 300px;
}
</style>
```

ä¸Šè¿°ä»£ç ä¸­ï¼Œtemplateä¸­æœ‰ä¸€ä¸ªæ™®é€šçš„divä½œä¸ºå®¹å™¨ï¼ˆå¿…é¡»æœ‰å®½é«˜ï¼‰ï¼Œscriptä¸­åœ¨onMountedå’ŒonUnmountedç”Ÿå‘½å‘¨æœŸå†…éƒ¨å»åˆå§‹åŒ–å›¾è¡¨å’Œé”€æ¯å›¾è¡¨ï¼Œå®ç°å›¾è¡¨çš„æ¸²æŸ“å’Œæ¸…ç†ï¼›åˆå§‹åŒ–å›¾è¡¨æ—¶è°ƒç”¨echartsçš„APIè¿›è¡Œåˆå§‹åŒ–å’Œæ¸²æŸ“ã€‚

å®é™…å¼€å‘ä¸­è¿˜å¯èƒ½å®ç°æ›´è¯¦ç»†æ›´å¤æ‚çš„å¯è§†åŒ–ç»„ä»¶å°è£…ã€‚

Echartsæ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„å¯è§†åŒ–æ¡†æ¶ï¼Œæœ‰é¥¼å›¾ã€åœ°å›¾ç­‰ä¸åŒç±»å‹çš„å›¾è¡¨ï¼Œå¦‚æœå¼•å…¥Echartså…¨éƒ¨ä»£ç çš„è¯ï¼Œé¡¹ç›®çš„ä½“ç§¯ä¼šå˜å¾—éå¸¸è‡ƒè‚¿ã€‚==> å¦‚æœä¸åŒçš„å›¾è¡¨ç±»å‹æŒ‰éœ€å¼•å…¥Echartsï¼Œé™¤äº†èƒ½å¤Ÿè®©ç»„ä»¶ä½¿ç”¨èµ·æ¥æ›´æ–¹ä¾¿ä¹‹å¤–ï¼Œæ•´ä½“é¡¹ç›®çš„åŒ…ä½“ç§¯ä¹Ÿä¼šä¼˜åŒ–å¾ˆå¤šã€‚



### æŒ‡ä»¤çš„å°è£…

æŒ‡ä»¤å¢å¼ºå‹ç»„ä»¶

åƒå›¾ç‰‡æ‡’åŠ è½½è¿™ç§åº“ï¼Œå’ŒDOMç»‘å®šï¼Œä½†åˆæ²¡æœ‰å•ç‹¬çš„ç»„ä»¶æ¸²æŸ“é€»è¾‘çš„æƒ…å†µï¼Œé€šå¸¸åœ¨Vueä¸­ä»¥æŒ‡ä»¤çš„å½¢å¼å­˜åœ¨ã€‚

```javascript
// src/directives/index.js
export const focus = {
    install(app) {
        app.directive('focus', {
            mounted(el) {
                el.focus();
            }
        })
    }
}
```

ä½¿ç”¨ï¼š

```javascript
// src/main.js
// ...
import {focus} from "./directives";

// ...
createApp(App).use(store)/*æ³¨å†Œæ•°æ®æº*/.use(router)/*æ³¨å†Œè·¯ç”±æ•°æ®*/
    .use(Element3)/*æ³¨å†Œç»„ä»¶åº“*/
    .use(focus)/*æ³¨å†ŒæŒ‡ä»¤*/
    .mount('#app')
```

```vue
<!-- src/pages/Login.vue -->
<input type="text" v-focus placeholder="v-focus test1"/>
```

æŒ‡ä»¤çš„ç”Ÿå‘½å‘¨æœŸå’Œç»„ä»¶ç±»ä¼¼ï¼Œé¦–å…ˆæˆ‘ä»¬è¦è®©æŒ‡ä»¤èƒ½å¤Ÿæ”¯æŒVueçš„æ’ä»¶æœºåˆ¶ï¼Œæ‰€ä»¥éœ€è¦åœ¨installå‡½æ•°å†…æ³¨å†ŒæŒ‡ä»¤ã€‚

```javascript
// src/directives/index.js
export const lazyPlugin = {
    install(app, options) {
        app.directives('lazy', {
            mounted(el, binding, vnode) {
            },
            updated(el, binding) {},
            unmount(el) {}
        })
    }
}
```

ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡lazyæŒ‡ä»¤è·å–åˆ°å½“å‰å›¾ç‰‡çš„æ ‡ç­¾ï¼Œå¹¶ä¸”è®¡ç®—å›¾ç‰‡çš„ä½ç½®ä¿¡æ¯ï¼Œåˆ¤æ–­å›¾ç‰‡æ˜¯å¦åœ¨å¯è§†åŒºåŸŸï¼Œæ¥å†³å®šå›¾ç‰‡æ˜¯å¦æ˜¾ç¤ºï¼›ä¸åœ¨å¯è§†åŒºåŸŸçš„è¯ï¼Œå°±åŠ è½½ä¸€ä¸ªé»˜è®¤å›¾ç‰‡ï¼Œåœ¨é¡µé¢å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œé‡æ–°è¿›è¡Œè®¡ç®—ï¼Œè¿™æ ·å°±å®ç°äº†é¡µé¢å›¾ç‰‡çš„æ‡’åŠ è½½ã€‚

Element3ä¸­çš„loadingğŸŒ°ï¼š

æ³¨å†Œäº†loadingDirectiveæŒ‡ä»¤ï¼Œå¹¶ä¸”æ³¨å†Œäº†mountedã€updatedã€unmountedä¸‰ä¸ªé’©å­å‡½æ•°ï¼Œé€šè¿‡v-loadingçš„å€¼æ¥å¯¹æ˜¾ç¤ºæ•ˆæœè¿›è¡Œåˆ‡æ¢ï¼Œå®ç°äº†ç»„ä»¶å†…éƒ¨çš„loadingçŠ¶æ€ã€‚

åŠ¨æ€åˆ‡æ¢çš„Loadingç»„ä»¶èƒ½å¤Ÿæ˜¾ç¤ºä¸€ä¸ªåœ†å½¢çš„divæ ‡ç­¾ï¼Œé€šè¿‡v-loadingæŒ‡ä»¤çš„æ³¨å†Œï¼ŒåŠ è½½çŠ¶æ€å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä½¿ç”¨v-loadingæ¥å®ç°ã€‚

```javascript

const loadingDirective = {
  mounted: function (el, binding, vnode) {
    const mask = createComponent(Loading, {
      ...options,
      onAfterLeave() {
        el.domVisible = false
        const target =
          binding.modifiers.fullscreen || binding.modifiers.body
            ? document.body
            : el
        removeClass(target, 'el-loading-parent--relative')
        removeClass(target, 'el-loading-parent--hidden')
      }
    })
    el.options = options
    el.instance = mask.proxy
    el.mask = mask.proxy.$el
    el.maskStyle = {}

    binding.value && toggleLoading(el, binding)
  },

  updated: function (el, binding) {
    el.instance.setText(el.getAttribute('element-loading-text'))
    if (binding.oldValue !== binding.value) {
      toggleLoading(el, binding)
    }
  },

  unmounted: function () {
    el.instance && el.instance.close()
  }
}

export default {
  install(app) {
    // if (Vue.prototype.$isServer) return
    app.directive('loading', loadingDirective)
  }
}
```

[loadingæºç ](https://github.com/hug-sun/element3/blob/master/packages/element3/packages/loading/directive.js#L36)



### å¼•å…¥ç¬¬ä¸‰æ–¹åº“çš„æ³¨æ„äº‹é¡¹

å°è£…ç¬¬ä¸‰æ–¹åº“çš„ç›®çš„ï¼šå®ç°ç¬¬ä¸‰æ–¹æ¡†æ¶å’ŒVueæ¡†æ¶çš„èåˆï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚

* æ— è®ºå¼•ç”¨ç¬¬ä¸‰æ–¹åº“è¿˜æ˜¯è‡ªå·±å°è£…çš„åº•å±‚åº“ï¼Œåœ¨ä½¿ç”¨ä¹‹åˆå°±è¦è€ƒè™‘åˆ°é¡¹ç›®çš„é•¿æœŸå¯ç»´æŠ¤æ€§

* å°½å¯èƒ½ä¸è¦å› ä¸ºæ’æœŸç­‰é—®é¢˜ï¼Œä¸€è‚¡è„‘æŠŠç¬¬ä¸‰æ–¹åº“å †åœ¨ä¸€èµ·ï¼Œè™½ç„¶å½“ä¸‹ç ”å‘é€Ÿåº¦å¿«ï¼Œä½†åæœŸç»´æŠ¤æˆæœ¬å¾€å¾€å¾ˆå¤§

* Vueä¸­çš„mixinã€extendsæœºåˆ¶èƒ½ä¸ç”¨å°±ä¸ç”¨ï¼šéƒ½ç”¨äºæ‰©å±•å’Œä¸°å¯Œthiså…³é”®å­—ï¼Œé¡¹ç›®å¤æ‚åï¼Œéšå¼æ·»åŠ çš„APIæ— ä»æº¯æºï¼Œä¸€æ—¦mixinæœ‰äº†å‘½åå†²çªï¼Œè°ƒè¯•èµ·æ¥éš¾åº¦å€å¢

* å…¨å±€å±æ€§ä¹Ÿå°½å¯èƒ½å°‘ç”¨

  Vue3ä¸­å¯ä»¥ä½¿ç”¨`app.config.globalProperties.x`æ³¨å†Œå…¨å±€å˜é‡ï¼Œå°‘ç”¨çš„åŸå› åœ¨äºå…¨å±€å˜é‡ä¼šæå¤§åœ°æé«˜ç»´æŠ¤æˆæœ¬ï¼›å¿…é¡»è¦ç”¨æ—¶ï¼ŒæŠŠæ‰€æœ‰æ³¨å†Œçš„å…¨å±€å˜é‡æ”¾åœ¨ä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶å»ç®¡ç†ã€‚

* å¼•å…¥ç¬¬ä¸‰æ–¹åº“å’Œæ¡†æ¶å¿…é¡»æ³¨æ„æŒ‰éœ€ä½¿ç”¨ï¼šå¼•å…¥å…¨éƒ¨ä»£ç çš„æ–¹å¼ä¼šè®©é¡¹ç›®ä½“ç§¯è¿‡å¤§



### æ€»ç»“

* å’ŒVueè€¦åˆæ€§ä¸å¼ºçš„ï¼Œç›´æ¥å¼•å…¥ä½¿ç”¨å³å¯
* éœ€è¦æŠŠç¬¬ä¸‰æ–¹åº“æ”¾åœ¨Vueçš„ç»„ä»¶å†…éƒ¨æ‰§è¡Œçš„ï¼š
  * è¿™ä¸ªæ¡†æ¶è¿›è¡ŒVue3çš„é€‚é…å·¥ä½œï¼Œä¸»è¦é€‚é…çš„è½½ä½“å°±æ˜¯ç»„ä»¶
    * å¯ä»¥ç›´æ¥é€ä¼ æ‰€æœ‰å‚æ•°æ¥åšä¸€ä¸ªè¾ƒæµ…çš„å°è£…
    * ä¹Ÿå¯ä»¥é’ˆå¯¹éœ€è¦ç”¨çš„ç»„ä»¶ç±»å‹é€ä¸ªå°è£…
* æŒ‡ä»¤å¢å¼ºå‹ç»„ä»¶çš„å°è£…ï¼šè¿™ç§åº“å’ŒDOMç»‘å®šï¼Œä½†æ²¡æœ‰å•ç‹¬çš„ç»„ä»¶æ¸²æŸ“é€»è¾‘ï¼Œé€šå¸¸åœ¨Vueä¸­ä»¥æŒ‡ä»¤çš„å½¢å¼å­˜åœ¨
  * å¸¸è§çš„ï¼š
    * å›¾ç‰‡æ‡’åŠ è½½
    * loadingæŒ‡ä»¤
* æ³¨æ„äº‹é¡¹
  * ä»é¡¹ç›®å¼€å§‹ä¹‹åˆå°±è¦è€ƒè™‘åˆ°é•¿æœŸç»´æŠ¤çš„æˆæœ¬ï¼Œä¸è¦ä¸€è‚¡è„‘åœ°å †ç Œä»£ç 
  * å°‘ç”¨å…¨å±€å˜é‡
  * æŒ‰éœ€å¼•å…¥å’Œä½¿ç”¨